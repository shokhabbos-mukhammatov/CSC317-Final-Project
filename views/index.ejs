<%- include('./partials/header') %>

<div class="container">
  <section class="welcome-section">
    <h1><%= message %></h1>
    <p>Plan smarter with Trip Tuner. Just enter your destination, travel dates, budget, and preferences â€” and get a personalized,
      day-by-day itinerary in seconds. Powered by AI, Trip Tuner makes travel planning simple, fast, and tailored just for you.</p>
<!--    <% if(!isAuthenticated) { %>-->
<!--      <div class="action-buttons">-->
<!--        <a href="/auth/login" class="btn primary-btn">Login</a>-->
<!--        <a href="/auth/register" class="btn secondary-btn">Register</a>-->
<!--      </div>-->
<!--    <% } %>-->
  </section>

  <section class="trip-generator-form">
    <h2>Plan Your Trip</h2>
    <%- include('./partials/form-errors') %>
    <form id="tripForm" action="/generate-itinerary" method="POST" novalidate>
      <input type="hidden" name="_csrf" value="<%= csrfToken %>">

      <div class="form-group">
        <label for="destination">Destination City</label>
        <input type="text" id="destination" name="destination" required maxlength="50" pattern="[a-zA-Z\s]+" title="Only letters and spaces allowed">
      </div>

      <div class="form-group">
        <label for="days">Number of Days</label>
        <input type="number" id="days" name="days" required min="1" max="30">
      </div>

      <div class="form-group">
        <label for="startDate">Start Date</label>
        <input type="date" id="startDate" name="startDate" required>
      </div>

      <div class="form-group">
        <label for="endDate">End Date</label>
        <input type="date" id="endDate" name="endDate" required>
      </div>

      <div class="form-group">
        <label for="budget">Budget (USD)</label>
        <input type="number" id="budget" name="budget" required min="1" max="100000">
      </div>

      <div class="form-group">
        <label for="preferences">Wishes & Preferences</label>
        <textarea id="preferences" name="preferences" required minlength="10" maxlength="500"></textarea>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn primary-btn">Generate Itinerary</button>
      </div>
    </form>
  </section>

  <% if (typeof itineraryResult !== 'undefined') { %>
    <section class="trip-result">
      <h2>Your AI-Generated Itinerary</h2>
      <div class="feature-card">
        <div class="ai-itinerary-output">
          <%- itineraryResult %> <!-- Use unescaped output to render HTML -->
        </div>
      </div>
    </section>
  <% } %>

  <section class="features-section">
    <h2>Features</h2>
    <div class="feature-grid">
      <div class="feature-card">
        <h3>User Authentication</h3>
        <p>Secure login and registration with password hashing</p>
      </div>
      <div class="feature-card">
        <h3>Session Management</h3>
        <p>Persistent sessions with secure cookies</p>
      </div>
      <div class="feature-card">
        <h3>Protected Routes</h3>
        <p>Restrict access to authenticated users only</p>
      </div>
    </div>
  </section>
</div>


<%- include('./partials/footer') %>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const startDateInput = document.getElementById('startDate');
    const endDateInput = document.getElementById('endDate');

    // Set min value of startDate to today
    const today = new Date().toISOString().split('T')[0];
    startDateInput.setAttribute('min', today);

    // When startDate changes, set min of endDate to the selected startDate
    startDateInput.addEventListener('change', function () {
      const selectedStart = this.value;
      endDateInput.setAttribute('min', selectedStart);

      // Optional: clear endDate if it became invalid
      if (endDateInput.value && endDateInput.value < selectedStart) {
        endDateInput.value = '';
      }
    });
  });
</script>